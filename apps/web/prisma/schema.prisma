generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Eksempelmodel â€“ tilpas frit
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AutomationTemplate {
  id         String   @id @default(uuid())
  slug       String   @unique
  name       String
  paramsSpec Json?
  runtime    String   @default("node")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  automations Automation[]
}

model Automation {
  id         String   @id @default(uuid())
  userId     String
  templateId String
  name       String
  params     Json
  enabled    Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  template  AutomationTemplate   @relation(fields: [templateId], references: [id])
  schedules AutomationSchedule[]
  runs      AutomationRun[]
}

model AutomationSchedule {
  id           String    @id @default(uuid())
  automationId String
  type         String // "every" | "cron" | "at"
  expression   String // fx "15m" eller "*/5 * * * *"
  nextRunAt    DateTime?
  enabled      Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  automation Automation @relation(fields: [automationId], references: [id])
}

model AutomationRun {
  id           String    @id @default(uuid())
  automationId String
  status       String // "queued" | "running" | "success" | "error"
  logs         String?
  error        String?
  startedAt    DateTime?
  finishedAt   DateTime?
  createdAt    DateTime  @default(now())

  automation Automation @relation(fields: [automationId], references: [id])
}
